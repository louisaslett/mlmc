<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Multi-level Monte Carlo estimation — mlmc • mlmc</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Multi-level Monte Carlo estimation — mlmc"><meta name="description" content="This function is the Multi-level Monte Carlo driver which will sample from the levels of user specified function."><meta property="og:description" content="This function is the Multi-level Monte Carlo driver which will sample from the levels of user specified function."><meta property="og:image" content="https://mlmc.louisaslett.com/logo.png"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mlmc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://people.maths.ox.ac.uk/~gilesm/mlmc/">Mike Giles MLMC page</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/louisaslett/mlmc/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Multi-level Monte Carlo estimation</h1>
      <small class="dont-index">Source: <a href="https://github.com/louisaslett/mlmc/blob/master/R/mlmc.R" class="external-link"><code>R/mlmc.R</code></a></small>
      <div class="d-none name"><code>mlmc.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function is the Multi-level Monte Carlo driver which will sample from the levels of user specified function.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">mlmc</span><span class="op">(</span></span>
<span>  <span class="va">Lmin</span>,</span>
<span>  <span class="va">Lmax</span>,</span>
<span>  <span class="va">N0</span>,</span>
<span>  <span class="va">eps</span>,</span>
<span>  <span class="va">mlmc_l</span>,</span>
<span>  alpha <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  beta <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  gamma <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-lmin">Lmin<a class="anchor" aria-label="anchor" href="#arg-lmin"></a></dt>
<dd><p>the minimum level of refinement.  Must be \(\ge 2\).</p></dd>


<dt id="arg-lmax">Lmax<a class="anchor" aria-label="anchor" href="#arg-lmax"></a></dt>
<dd><p>the maximum level of refinement.  Must be \(\ge\) <code>Lmin</code>.</p></dd>


<dt id="arg-n-">N0<a class="anchor" aria-label="anchor" href="#arg-n-"></a></dt>
<dd><p>initial number of samples which are used for the first 3 levels and for any subsequent levels which are automatically added.
Must be \(&gt; 0\).</p></dd>


<dt id="arg-eps">eps<a class="anchor" aria-label="anchor" href="#arg-eps"></a></dt>
<dd><p>the target accuracy of the estimate (root mean square error).
Must be \(&gt; 0\).</p></dd>


<dt id="arg-mlmc-l">mlmc_l<a class="anchor" aria-label="anchor" href="#arg-mlmc-l"></a></dt>
<dd><p>a user supplied function which provides the estimate for level \(l\).
       It must take at least two arguments, the first is the level number to be simulated and the second the number of paths.
       Additional arguments can be taken if desired: all additional <code>...</code> arguments to this function are forwarded to the user defined <code>mlmc_l</code> function.</p>
<p>The user supplied function should return a named list containing one element named <code>sums</code> and second named <code>cost</code>, where:</p><dl><dt><code>sums</code></dt>
<dd><p>is a vector of length two \(\left(\sum Y_i, \sum Y_i^2\right)\) where \(Y_i\) are iid simulations with expectation \(E[P_0]\) when \(l=0\) and expectation \(E[P_l-P_{l-1}]\) when \(l&gt;0\).</p></dd>

         <dt><code>cost</code></dt>
<dd><p>is a scalar with the total cost of the paths simulated.
                            For example, in the financial options samplers included in this package, this is calculated as \(NM^l\), where \(N\) is the number of paths requested in the call to the user function <code>mlmc_l</code>, \(M\) is the refinement cost factor (\(M=2\) for <code><a href="mcqmc06_l.html">mcqmc06_l()</a></code> and \(M=4\) for <code><a href="opre_l.html">opre_l()</a></code>), and \(l\) is the level being sampled.</p></dd>


</dl><p>See the function (and source code of) <code><a href="opre_l.html">opre_l()</a></code> and <code><a href="mcqmc06_l.html">mcqmc06_l()</a></code> in this package for an example of user supplied level samplers.</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>the weak error, \(O(2^{-\alpha l})\).
Must be \(&gt; 0\) if specified.
If <code>NA</code> then <code>alpha</code> will be estimated.</p></dd>


<dt id="arg-beta">beta<a class="anchor" aria-label="anchor" href="#arg-beta"></a></dt>
<dd><p>the variance, \(O(2^{-\beta l})\).
Must be \(&gt; 0\) if specified.
If <code>NA</code> then <code>beta</code> will be estimated.</p></dd>


<dt id="arg-gamma">gamma<a class="anchor" aria-label="anchor" href="#arg-gamma"></a></dt>
<dd><p>the sample cost, \(O(2^{\gamma l})\).
Must be \(&gt; 0\) if specified.
If <code>NA</code> then <code>gamma</code> will be estimated.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>if an integer is supplied, R will fork <code>parallel</code> parallel processes and compute each level estimate in parallel.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>additional arguments which are passed on when the user supplied <code>mlmc_l</code> function is called.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing:</p><dl><dt><code>P</code></dt>
<dd><p>The MLMC estimate;</p></dd>

  <dt><code>Nl</code></dt>
<dd><p>A vector of the number of samples performed on each level;</p></dd>

  <dt><code>Cl</code></dt>
<dd><p>Per sample cost at each level.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The Multilevel Monte Carlo Method method originated in the works Giles (2008) and Heinrich (1998).</p>
<p>Consider a sequence \(P_0, P_1, \ldots\), which approximates \(P_L\) with increasing accuracy, but also increasing cost, we have the simple identity
$$E[P_L] = E[P_0] + \sum_{l=1}^L E[P_l-P_{l-1}],$$
and therefore we can use the following unbiased estimator for \(E[P_L]\),
$$N_0^{-1} \sum_{n=1}^{N_0} P_0^{(0,n)} + \sum_{l=1}^L \left\{ N_l^{-1} \sum_{n=1}^{N_l} \left(P_l^{(l,n)} - P_{l-1}^{(l,n)}\right) \right\}$$
where \(N_l\) samples are produced at level \(l\).
The inclusion of the level \(l\) in the superscript \((l,n)\) indicates that the samples used at each level of correction are independent.</p>
<p>Set \(C_0\), and \(V_0\) to be the cost and variance of one sample of \(P_0\), and \(C_l, V_l\) to be the cost and variance of one sample of \(P_l - P_{l-1}\), then the overall cost and variance of the multilevel estimator is \(\sum_{l=0}^L N_l C_l\) and \(\sum_{l=0}^L N_l^{-1} V_l\), respectively.</p>
<p>The idea behind the method, is that provided that the product \(V_l C_l\) decreases with \(l\), i.e. the cost increases with level slower than the variance decreases, then one can achieve significant computational savings, which can be formalised as in Theorem 1 of Giles (2015).</p>
<p>For further information on multilevel Monte Carlo methods, see the webpage <a href="https://people.maths.ox.ac.uk/gilesm/mlmc_community.html" class="external-link">https://people.maths.ox.ac.uk/gilesm/mlmc_community.html</a> which lists the research groups working in the area, and their main publications.</p>
<p>This function is based on GPL-2 'Matlab' code by Mike Giles.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Giles, M.B. (2008) 'Multilevel Monte Carlo Path Simulation', <em>Operations Research</em>, 56(3), pp. 607–617. Available at: <a href="https://doi.org/10.1287/opre.1070.0496" class="external-link">doi:10.1287/opre.1070.0496</a>
.</p>
<p>Giles, M.B. (2015) 'Multilevel Monte Carlo methods', <em>Acta Numerica</em>, 24, pp. 259–328. Available at: <a href="https://doi.org/10.1017/S096249291500001X" class="external-link">doi:10.1017/S096249291500001X</a>
.</p>
<p>Heinrich, S. (1998) 'Monte Carlo Complexity of Global Solution of Integral Equations', <em>Journal of Complexity</em>, 14(2), pp. 151–175. Available at: <a href="https://doi.org/10.1006/jcom.1998.0471" class="external-link">doi:10.1006/jcom.1998.0471</a>
.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Louis Aslett &lt;louis.aslett@durham.ac.uk&gt;</p>
<p>Mike Giles &lt;Mike.Giles@maths.ox.ac.uk&gt;</p>
<p>Tigran Nagapetyan &lt;nagapetyan@stats.ox.ac.uk&gt;</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu">mlmc</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">1000</span>, <span class="fl">0.01</span>, <span class="va">opre_l</span>, option <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $P</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 10.44813</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Nl</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 4294178  357038  106626   22315</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Cl</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  1  4 16 64</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">mlmc</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">10</span>, <span class="fl">1000</span>, <span class="fl">0.01</span>, <span class="va">mcqmc06_l</span>, option <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $P</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 10.43656</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Nl</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3018378   56809   28405    8180    3002    1100     378     146</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Cl</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]   1   2   4   8  16  32  64 128</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Maintained by Louis Aslett.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

